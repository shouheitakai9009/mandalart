# マンダラート管理アプリケーション 要件定義書

## 1. 概要

マンダラート（Mandala Chart）は、目標設定やアイデア発想に役立つ9x9のグリッド形式のツールです。本アプリケーションは、ユーザーが目標を設定し、それに向けた具体的なタスクを管理し、週次で進捗をトラッキングできる Web アプリケーションです。

## 2. データモデル

### 2.1 テーブル構成

アプリケーションは以下の5つの主要テーブルで構成されます：

1. **User（ユーザーテーブル）**
2. **Mandalart（マンダラートテーブル）**
3. **MandalartSnapshot（マンダラートスナップショットテーブル）**
4. **Goal（目標テーブル）**
5. **Task（タスクテーブル）**

### 2.2 データ構造

```
User
└── Mandalart（複数可能）
    ├── mainGoal（大目標 - 中心のセル）
    ├── MandalartSnapshot（週次スナップショット）
    └── Goal（8つの目標）
        └── Task（各目標に8つのタスク）
```

## 3. コア機能

### 3.1 マンダラート作成フロー

#### ステップ1: 大目標の入力
- ユーザーが新しいマンダラートを作成する際、最初に**大目標**を入力
- 大目標はマンダラートの中心（中央のセル）に配置
- この大目標は `Mandalart` テーブルの `mainGoal` フィールドに保存

#### ステップ2: 8つの目標の入力
- 大目標を達成するための**8つの目標**を入力
- これらは大目標を囲む中心の周りの8つのセルに配置
- `Goal` テーブルに保存され、`position` フィールド（1-8）で位置を管理

#### ステップ3: 各目標に対する8つのタスクの入力
- 各目標に対して、具体的な**8つのタスク**を入力
- 各タスクには以下の情報を含む：
  - **タスク名**（例: "ジムに行く"）
  - **現在の実行回数**（例: 1）
  - **目標回数**（例: 7）
  - **目標単位**（例: "回"、"日"、"時間" など - 自由入力）
- UI上では「ジムに行く 1/7回」のように表示
- `Task` テーブルに保存され、`currentCount`、`targetCount`、`targetUnit` で管理

### 3.2 週次サイクル

#### 開始日・終了日
- マンダラートは**毎週月曜日に開始**される
- **毎週日曜日に終了**する

#### スナップショット自動作成
- 毎週日曜日の終了時点で、マンダラートの状態を自動的に**スナップショット**として保存
- スナップショットには以下の情報が含まれる：
  - その時点の大目標
  - 全ての目標とタスクの状態（JSON形式）
  - その週の開始日（月曜日）
  - その週の終了日（日曜日）
- `MandalartSnapshot` テーブルに保存

#### 継続的な更新
- スナップショット作成後も、マンダラートは**引き続きアクティブ**な状態を維持
- ユーザーは翌週もタスクの実行回数を更新し続けることができる
- 次の週末（日曜日）に再度スナップショットが作成される

### 3.3 マンダラート完了

#### 完了ボタン
- ユーザーが**完了ボタン**を押した時点で、マンダラートのステータスが `COMPLETED` に変更
- 完了時に `endDate` が設定される
- 完了したマンダラートは編集不可となる

#### 新規マンダラート作成
- マンダラート完了後、ユーザーは**新しいマンダラート**を作成可能
- 1ユーザーは**複数のアクティブなマンダラート**を同時に持つことができる
  - 例: 仕事用、プライベート用など、用途を分けて管理可能

## 4. 機能要件

### 4.1 マンダラート管理

#### 4.1.1 作成
- [ ] 大目標の入力
- [ ] 8つの目標の入力
- [ ] 各目標に対する8つのタスクの入力（タスク名、目標回数、目標単位）
- [ ] マンダラートの開始日を月曜日に自動設定

#### 4.1.2 編集・更新
- [ ] タスクの実行回数の更新（`currentCount` のインクリメント）
- [ ] 目標やタスクの内容の編集（アクティブなマンダラートのみ）
- [ ] 目標単位の変更

#### 4.1.3 表示
- [ ] マンダラート全体のグリッド表示（9x9）
- [ ] タスクの進捗表示（例: "ジムに行く 1/7回"）
- [ ] 進捗率の計算と表示（currentCount / targetCount）

#### 4.1.4 完了
- [ ] 完了ボタンの実装
- [ ] ステータスを `COMPLETED` に変更
- [ ] 完了日時（`endDate`）の記録

#### 4.1.5 複数マンダラート管理
- [ ] 複数のアクティブなマンダラートの一覧表示
- [ ] マンダラート間の切り替え機能
- [ ] 各マンダラートの進捗サマリー表示

### 4.2 スナップショット機能

#### 4.2.1 自動作成
- [ ] 毎週日曜日に自動でスナップショットを作成するバッチ処理
- [ ] スナップショット作成時に全データ（goals + tasks）をJSON形式で保存
- [ ] 週の開始日・終了日の記録

#### 4.2.2 閲覧
- [ ] 過去のスナップショット一覧表示
- [ ] 特定のスナップショットの詳細表示
- [ ] 週ごとの進捗の変化を確認

### 4.3 統計・分析機能

#### 4.3.1 進捗分析
- [ ] タスクの達成率の推移グラフ
- [ ] 目標別の進捗状況の可視化
- [ ] 週次での進捗レポート

#### 4.3.2 過去データの活用
- [ ] 完了したマンダラートの閲覧
- [ ] 過去のスナップショットとの比較
- [ ] 長期的な目標達成トレンドの分析

### 4.4 削除機能

#### 4.4.1 ソフトデリート
- [ ] マンダラートの論理削除（`deletedAt` を設定）
- [ ] 削除したマンダラートの一覧表示
- [ ] 削除したマンダラートの復元機能（オプション）

#### 4.4.2 完全削除
- [ ] 削除済みマンダラートの完全削除機能
- [ ] 関連するスナップショット、目標、タスクもカスケード削除

## 5. 非機能要件

### 5.1 パフォーマンス
- マンダラート一覧の表示は3秒以内
- タスク更新のレスポンスは1秒以内
- スナップショット作成は5秒以内に完了

### 5.2 データ整合性
- 1つのマンダラートには必ず8つの目標が存在する
- 1つの目標には必ず8つのタスクが存在する
- スナップショットは削除不可（履歴の保全）

### 5.3 セキュリティ
- ユーザーは自分のマンダラートのみアクセス可能
- 他ユーザーのデータは閲覧・編集不可
- 認証・認可の実装

### 5.4 スケーラビリティ
- 1ユーザーあたり最大100個のマンダラートをサポート
- 各マンダラートあたり最大52個のスナップショット（1年分）をサポート

## 6. UI/UX要件

### 6.1 マンダラートグリッド表示
- 9x9のグリッドで視覚的に表示
- 中心のセルは大目標を強調表示
- 各セルにタスクの進捗状況を表示

### 6.2 レスポンシブデザイン
- PC、タブレット、スマートフォンで適切に表示
- タッチ操作に対応

### 6.3 直感的な操作
- ドラッグ&ドロップでタスクを並び替え（オプション）
- ワンクリックでタスクの実行回数を更新
- プログレスバーで視覚的に進捗を確認

## 7. 技術要件

### 7.1 使用技術
- フロントエンド: Next.js (App Router), TypeScript, Tailwind CSS, Framer Motion
- 状態管理: Redux Toolkit
- バックエンド: Next.js API Routes
- データベース: Vercel Postgres (PostgreSQL)
- ORM: Prisma
- デプロイ: Vercel

### 7.2 バッチ処理
- 毎週日曜日23:59にスナップショット作成バッチを実行
- Vercel Cron Jobs または外部スケジューラーを使用

## 8. 今後の拡張機能（将来的な検討事項）

### 8.1 コラボレーション機能
- マンダラートの共有機能
- チームでの目標管理

### 8.2 通知機能
- タスクのリマインダー
- 週次レポートのメール送信

### 8.3 テンプレート機能
- よく使う目標のテンプレート保存
- 他ユーザーのテンプレート共有

### 8.4 エクスポート機能
- PDFでのエクスポート
- 画像としてのエクスポート

## 9. 開発フェーズ

### フェーズ1: 基本機能（MVP）
- マンダラート作成・編集・削除
- タスクの進捗管理
- 基本的なUI/UX

### フェーズ2: スナップショット機能
- 週次スナップショットの自動作成
- 過去データの閲覧

### フェーズ3: 分析機能
- 統計・分析ダッシュボード
- グラフやチャートでの可視化

### フェーズ4: 拡張機能
- 通知機能
- エクスポート機能
- その他のエンハンスメント
